# 数字货币两个核心的问题
## 数字货币的发行
## 验证交易的有效性，防止双花攻击
# 交易
区块链的交易是指发送一条虚拟的请求，如A要给B转一个币，那么A就发起了一条交易，其中包含A的转币地址，B的收币地址，金额和数字签名。交易数据既包含了币的“来源”，又包含了“去向”信息。  
![比特币交易](https://github.com/xielizyh/BlockChain/blob/main/image/%E6%AF%94%E7%89%B9%E5%B8%81%E4%BA%A4%E6%98%93.jpg)
## Coinbase交易
比特币第一笔交易成为Coinbase交易。它的作用是记录挖出一个区块的矿工获得奖励的信息。
## 双花攻击
Double spending attack，双重花费。当B非法向F转账5个币时，系统中其他节点向前回溯一下币的来源，发现B在之前5个币已经花费出去了，即向C转账2个币，向D转账3个币，因此该非法交易不被系统中其他节点承认，也就不会写入到区块链中。
# 区块
![区块](https://github.com/xielizyh/BlockChain/blob/main/image/%E5%8C%BA%E5%9D%97.jpg)
# 分布式共识
## FLP不可能原理
在网络可靠但允许节点失效的最小化异步模型系统中，不存在一个可以解决一致性问题的确定性算法。
## CAP原理
分布式系统无法同时确保一致性（Consistency）、可用性（Availability）和分区容忍性（Partition tolerance）。
在Paxos算法中，可能存在无法提供可用结果的情形，同时允许少数节点离线。
# 比特币中共识
## 基于投票产生的共识
著名的如联盟链，hyperledger fabric
### 女巫攻击（Sybil Attack）
通过单个节点伪造出多个虚假身份实施网络欺诈。类似于网络上的投票，如果作恶者注册了多个ID，用多个身份对同一个作品狂打高分，就会对评分的结果造成严重影响。
## PoW共识机制
### 分叉攻击(forking attack)
![分叉攻击](https://github.com/xielizyh/BlockChain/blob/main/image/%E5%88%86%E5%8F%89%E6%94%BB%E5%87%BB.jpg)
B在第二个区块后添加一个自己转给“自己”交易的区块，这样就可以回滚上面那个自己已经花费的币。但这貌似可行，实则不行，因为比特币只认最长合法链。
### 出块奖励（block reward）
每隔21万个区块，出块奖励减半。50BTC ——> 25BTC ——> 12.5BTC。
## Hash Rate
比特币采用PoW共识机制，其对女巫攻击具有天然的防御能力。因为PoW制定的规则是酬赏挖矿最勤的矿工，算力越强，挖矿成功的概率也就越高。归根到底是矿机这个物理实体决定在链上话语权。
## 挖矿
## 矿工